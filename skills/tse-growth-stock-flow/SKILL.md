---
name: tse-growth-stock-flow
description: 成長株候補を抽出し、成長7観点で定量+定性評価して上位3件の条件付き投資判断を作るワークフロー。「成長株候補をリストして」という指令で実行する。`data/sbi_screening/成長株/成長株_yyyymmdd.csv` を使った候補20件テーブル作成、除外ルール判定、ニュースを含む詳細調査を行うときに使う。`docs/agent_specs/tse-growth-stock-flow-v1.md` 準拠の手順で分析・再実行・レポート更新が必要な場面で呼び出す。
---

# TSE Growth Stock Flow

## Overview

このスキルは `docs/agent_specs/tse-growth-stock-flow-v1.md` の v1 仕様を実行用手順に落としたものです。  
`data/sbi_screening/成長株/成長株_yyyymmdd.csv` を入力に「成長株候補」を評価し、候補20件と上位3件の投資判断（Recommend / Watch / Skip）を出力します。

## Inputs

- 必須入力:
  - `data/sbi_screening/成長株/成長株_yyyymmdd.csv`
- 推奨入力:
  - `--output reports`（レポート出力先）
- 主な環境変数:
  - `OPENAI_API_KEY`
  - `WEB_NEWS_MAX_ITEMS`

## As-of Rule

- `--as-of` は手動入力せず、`data/sbi_screening/成長株` 配下の `成長株_*.csv` から決定する。
- ファイル名に日付（例: `成長株_20260218.csv`）がある場合は、その最大日付を `as-of` に使う。
- 日付を抽出できないCSVのみの場合は、更新時刻が最も新しいCSVの日付を `as-of` に使う。
- 解決スクリプト: `skills/tse-growth-stock-flow/scripts/latest_csv_asof.py`

## Workflow

1. 実行条件を確認する。
- 取引執行は行わず、推薦のみ出力する。
- 採点根拠は数値列と公開情報（決算説明資料、適時開示、ニュース）で残す。

2. 定量スクリーニングを実行する。
- まず `売上成長力` を最重視し、定量総合点(0-100)で上位20件を候補にする。
- 定量総合点は次の重みで採点する。
  - 売上成長力 35点（売上高成長率(予)、過去3年平均売上高成長率(予)、経常利益成長率(予)）
  - TAM/拡張余地 10点（市場成長率比較、新領域・海外余地、規制/技術追い風）
  - 利益構造の改善余地 15点（売上高営業利益率、営業利益率トレンド、スケールメリット）
  - 競争優位性 10点（技術・データ・ブランド・参入障壁）
  - 経営陣の質 10点（実績、株式保有、希薄化の健全性）
  - 財務の耐久力 10点（自己資本比率、有利子負債自己資本比率、FCF改善）
  - バリュエーション妥当性 10点（PER/PSRの相対比較、将来利益整合）

3. 候補20件を定性7軸で採点する。
- 各軸を0-5点で採点する。
- 根拠テキスト、参照URL、取得日付を必ず残す。
- 7軸:
  - 売上成長力（最重要、3年以上の連続成長を高評価）
  - 市場規模（TAM）と拡張余地
  - 利益構造の改善余地
  - 競争優位性（モート）
  - 経営陣の質
  - 財務の耐久力
  - バリュエーション妥当性

4. 除外ルールを適用する。
- GC疑義、重大不正、債務超過、長期営業CF悪化、流動性不足、説明不十分な大幅下方修正を除外候補にする。

5. 暫定総合点で上位3件を選定する。
- 暫定総合点 = 定量総合点(0-100) + 定性総合点(100点換算)。
- 除外フラグ付き銘柄を除外する。

6. 上位3件を詳細調査する。
- 直近ニュース（30日以内を優先）を確認する。
- ポジ/ネガ材料、反証（買わない理由）、ベース/強気/弱気シナリオを整理する。
- 業種トレンドと同業比較（強み/弱み）を反映する。

7. 出力を整形する。
- 候補20件テーブルに必須列を含める。
- 上位3件レポートに推薦判断、理由、主要リスク、前提条件、破綻シナリオ、再評価トリガー、根拠リンクを含める。

8. 上位3件の付録評価を作成する。
- レポート末尾に `Appendix: Detailed Investment Evaluation (Top 3)` を追加する。
- 上位3件それぞれに対して、定量データと定性評価を分けて次の5観点を記載する。
  - ① 業績の安定性と成長性
  - ② 財務健全性
  - ③ 競争優位性（モート）
  - ④ バリュエーション
  - ⑤ 経営陣の質
- 最後に総合評価として、`総合点(100点)`、`投資スタンス`、`主なリスク3点`、`カタリスト3点`、`3行結論` を記載する。
- 未取得データは推測で埋めず、`本レポート収集範囲外（要補完）` と明示する。

## Standard Command

```bash
AS_OF="$(python3 skills/tse-growth-stock-flow/scripts/latest_csv_asof.py --data-dir data/sbi_screening/成長株)"
PYTHONPATH=src python3.11 -m ai_investor.main \
  --config config/strategy_growth_sbi_csv.yaml \
  --as-of "$AS_OF" \
  --output reports
```

### Execution Environment

- 標準コマンドは **サンドボックス外** で実行する。
- 理由: `OPENAI_API_KEY` を使うLLM評価とWebニュース取得で外部ネットワーク疎通が必要なため。
- Codex実行時は `sandbox_permissions: require_escalated` を指定して実行する。

必要に応じて `--top-n` / `--top-k` を指定して母集団や最終件数を調整する。  
この標準コマンドの出力は一次スクリーニング結果として扱い、最終判断は本スキルの成長7観点で再採点する。

## Audit Log Rules

- 銘柄ごとに根拠URL・取得日・採点理由を保持する。
- スコア変更履歴を保持する。
- 参照不能リンクを定期検知する。

## Reference

- 詳細仕様: `references/agent_spec_v1.md`
